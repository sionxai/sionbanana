# AGENTS.md — Sion Banana 에이전트 작업 지침

## 범위와 우선순위
- 이 파일이 위치한 디렉터리 트리 전체에 적용됩니다.
- 더 깊은 경로의 AGENTS.md가 있을 경우 그 지침이 우선합니다.
- 사용자·개발자 메시지의 직접 지시가 항상 최상위 우선입니다.

## 기본 언어·톤
- 기본 커뮤니케이션 언어는 한국어입니다. 코드/명령/식별자는 영문 그대로 사용합니다.
- 간결하고 친절하게, 불필요한 장황함 없이 결과 중심으로 설명합니다.

## 수정 전 승인 절차 (필수)
에이전트가 코드를 수정하거나 파일을 추가/삭제하기 전, 반드시 다음 수순을 거치고 사용자 확인 후 진행합니다.

1) 3줄 요약(what/why/how)
- 무엇을, 왜, 어떻게 바꿀지 한 줄씩 총 3줄로 요약합니다.

2) 구체적 수정 계획(체크리스트)
- 실행 가능한 단계 목록(5~8개 내외)으로 제시합니다. 파일 경로·비즈니스 영향·타입 변경 등 핵심을 포함합니다.
- 단계별 진행 상태는 Codex의 `update_plan` 기능으로 공유합니다.

3) 확인 요청(명시적 동의)
- “위 계획으로 진행할까요? (예/아니오, 수정사항 제안 가능)” 형태로 명시적 동의를 받습니다.
- 동의 없이 `apply_patch` 등 파일 변경 도구를 실행하지 않습니다.

예시 템플릿
```
요약
- 무엇: /api/storyboard 타입 불일치 수정
- 왜: 빌드 실패(Type 'null' → 'undefined' 미스매치)
- 어떻게: 반환타입 정합화 + 클라이언트 가드 보강

계획
1) app/api/storyboard/route.ts 타입 정합화
2) 클라이언트 오류 처리(components/prompt/*) 보강
3) 변형 스튜디오 프리셋 타입 범위 점검
4) 빌드/타입체크 실행 및 결과 공유
5) 변경 요약 및 영향도 기록(README/CHANGELOG)

확인: 위 계획으로 진행할까요?
```

## 커뮤니케이션 & 도구 사용
- 터미널 명령 실행 전, 1–2문장으로 즉시 다음 행동을 안내합니다(무거운 작업만).
- 파일/텍스트 검색은 `rg` 우선 사용, 파일 편집은 `apply_patch`만 사용합니다.
- 큰 파일은 최대 250줄 단위로 읽고, 필요한 구간만 출력합니다.
- 빌드/린트/테스트 등 무거운 명령은 사용자 확인 후 실행합니다.

## 코드 변경 원칙
- 최소 변경으로 근본 원인 해결(스코프 크지 않게), 기존 코드 스타일 유지.
- 관련 없는 리팩터·대규모 포맷팅·패키지 추가 금지.
- 타입스크립트: `null`/`undefined` 구분을 명확히 하고 선언-반환 타입을 일치시킵니다.
- 테스트/검증은 변경 영역에 한정해 우선 수행하고, 필요 시 범위를 넓힙니다.

## Next.js/ESLint 가이드
- ESLint 경고는 기능 저해 시에만 수정합니다. 단, 타입 오류는 반드시 해결합니다.
- `<img>` → `next/image` 치환은 성능/품질 이득이 분명할 때만 수행합니다.

## 보안·환경 변수
- 비밀키 하드코딩 금지. `.env.local` 사용 및 Git 커밋 금지.
- `OPENAI_API_KEY`, `GEMINI_API_KEY`, Firebase 값은 서버/클라이언트 구분을 지킵니다.
- 로그에 민감정보 전체를 출력하지 않습니다(앞 6~10자 마스킹 등).

## 스토리보드 모듈(프로젝트 특화)
- `/api/storyboard` 응답은 `{ ok: boolean }`을 기준으로 분기하고, 실패 시 `reason`을 제공합니다.
- 스타일 조회 실패 시 내장 Fallback을 사용하고, 없으면 명확한 오류를 반환합니다.
- 자연어(`natural`)와 JSON(`json`) 모드는 분기하여 프롬프트를 구성합니다.

## 금지 사항
- 사용자 요청 없는 대규모 리네이밍/포맷팅/폴더 이동.
- 파괴적 명령(`rm -rf`, `git reset --hard`) 무허가 실행.
- 외부 네트워크/설치/권한 상승이 필요한 작업의 무통보 실행.

## 작업 종료 시
- 변경 파일·핵심 차이·검증 결과를 간단히 요약하고, 다음 권장 작업이 있으면 1~2개 제안합니다.

